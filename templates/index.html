{% extends "base.html" %}

{% block content %}
<h1 class="page-title">Dashboard</h1>

<section class="cards-row">
  <div class="card card-animate card-float">
    <div class="card-label">Customers</div>
    <div class="card-value">{{ stats.total_customers }}</div>
    <div class="card-sub">Total active customers in your ERP.</div>
  </div>

  <div class="card card-animate card-pulse">
    <div class="card-label">Orders</div>
    <div class="card-value">{{ stats.total_orders }}</div>
    <div class="card-sub">All recorded Shopify / manual orders.</div>
  </div>

  <div class="card card-animate card-glow">
    <div class="card-label">Income</div>
    <div class="card-value">{{ '{:,.2f}'.format(stats.total_income or 0) }}</div>
    <div class="card-sub">Total income from all orders.</div>
  </div>

  <div class="card card-animate card-hover-lift">
    <div class="card-label">Open Tasks</div>
    <div class="card-value">{{ stats.open_tasks }}</div>
    <div class="card-sub">Pending items to follow up.</div>
  </div>
</section>

<section class="summary-strip">
  <div class="summary-pill">
    <span class="summary-label">Total Expenses</span>
    <span class="summary-value">{{ '{:,.2f}'.format(stats.total_expenses or 0) }}</span>
  </div>
  <div class="summary-pill summary-pill-accent">
    <span class="summary-label">Net Balance (Income - Expenses)</span>
    <span class="summary-value">
      {{ '{:,.2f}'.format((stats.total_income or 0) - (stats.total_expenses or 0)) }}
    </span>
  </div>
</section>

<section class="two-cols">
  <div class="panel">
    <div class="panel-header">
      <h2>Recent Customers</h2>
      <span class="panel-sub">Last 5 customers you added</span>
    </div>
    <table class="plain-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Name</th>
          <th>City</th>
          <th>Country</th>
        </tr>
      </thead>
      <tbody>
      {% for c in recent_customers %}
        <tr>
          <td>{{ c.created_at.strftime('%Y-%m-%d') }}</td>
          <td>{{ c.name }}</td>
          <td>{{ c.city or '-' }}</td>
          <td>{{ c.country or '-' }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4">No customers yet.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="panel">
    <div class="panel-header">
      <h2>Recent Orders</h2>
      <span class="panel-sub">Last 5 orders</span>
    </div>
    <table class="plain-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Customer</th>
          <th>Total</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
      {% for o in recent_orders %}
        <tr>
          <td>{{ o.order_date.strftime('%Y-%m-%d') }}</td>
          <td>{{ o.customer_name or '-' }}</td>
          <td>{{ '{:,.2f}'.format(o.total_amount or 0) }}</td>
          <td>{{ o.status or '-' }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4">No orders yet.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="tasks-strip">
  <div class="tasks-strip-header">
    <h2>Recent Tasks</h2>
    <span class="panel-sub">Quick view of pending work</span>
  </div>

  <div class="tasks-progress">
    <div class="tasks-progress-label">
      Open tasks: {{ stats.open_tasks }}
    </div>
    <div class="tasks-progress-bar">
      {# simple animated bar, width is just visual; not exact % #}
      <div class="tasks-progress-fill"></div>
    </div>
    <div class="tasks-progress-note">
      This bar gently animates to draw your attention to open work items.
    </div>
  </div>

  <div class="tasks-table-wrapper">
    <table class="plain-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Title</th>
          <th>Status</th>
          <th>Priority</th>
        </tr>
      </thead>
      <tbody>
      {% for t in recent_tasks %}
        <tr>
          <td>{{ t.date.strftime('%Y-%m-%d') }}</td>
          <td>{{ t.title }}</td>
          <td>{{ t.status }}</td>
          <td>{{ t.priority }}</td>
        </tr>
      {% else %}
        <tr><td colspan="4">No tasks yet.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
