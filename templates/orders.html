{% extends "base.html" %}

{% block content %}
<h1>Orders</h1>

<section class="two-cols">
    <div class="panel">
        <h2>Add Order</h2>
        <form method="post" class="simple-form">
            <label>Order Date
                <input type="date" name="order_date">
            </label>
            <label>Order Number
                <input type="text" name="order_number" required>
            </label>
            <label>Customer
                <select name="customer_id">
                    <option value="">-- None --</option>
                    {% for c in customers %}
                        <option value="{{ c.id }}">{{ c.name }}</option>
                    {% endfor %}
                </select>
            </label>
            <label>Total Amount
                <input type="number" step="0.01" name="total_amount" required>
            </label>
            <label>Currency
                <input type="text" name="currency" value="USD">
            </label>
            <label>Payment Status
                <input type="text" name="payment_status" placeholder="Paid, Pending, Refunded...">
            </label>
            <label>Fulfillment Status
                <input type="text" name="fulfillment_status" placeholder="Fulfilled, Unfulfilled...">
            </label>
            <label>Sales Channel
                <input type="text" name="sales_channel" placeholder="Online store, POS...">
            </label>
            <label>Note
                <input type="text" name="note">
            </label>
            <button type="submit">Save Order</button>
        </form>
    </div>

    <div class="panel">
        <div class="panel-header">
            <h2>List (Total: {{ total_sales }})</h2>
            <form method="get" class="filters-row">
                <input type="date" name="start_date" value="{{ start_date }}">
                <span>to</span>
                <input type="date" name="end_date" value="{{ end_date }}">
                <input type="text" name="search" value="{{ search }}" placeholder="Search order # / status">
                <button type="submit">Filter</button>
                <a class="link-button" href="{{ url_for('export_orders', start_date=start_date, end_date=end_date) }}">Export</a>
            </form>
        </div>

        <table class="plain-table">
            <thead>
                <tr>
                    <th>Date</th><th>Order #</th><th>Customer</th><th>Total</th><th>Payment</th><th>Fulfillment</th><th>Channel</th><th>Action</th>
                </tr>
            </thead>
            <tbody>
            {% for o in orders %}
                <tr>
                    <td>{{ o.order_date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ o.order_number }}</td>
                    <td>{% if o.customer_id %}{{ o.customer_id }}{% endif %}</td>
                    <td>{{ o.total_amount }} {{ o.currency }}</td>
                    <td>{{ o.payment_status }}</td>
                    <td>{{ o.fulfillment_status }}</td>
                    <td>{{ o.sales_channel }}</td>
                    <td><a href="{{ url_for('delete_order', order_id=o.id) }}" onclick="return confirm('Delete this order?')">Delete</a></td>
                </tr>
            {% else %}
                <tr><td colspan="8">No orders yet.</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
